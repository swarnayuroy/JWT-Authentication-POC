using DataContext.DataProvider;
using DataContext.DataService;
using DataContext.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using System.Web;
using web.Service.DTO;

namespace web.Service.DataLayer
{
    //public class Data
    //{
    //    private IEnumerable<UserDetail> _user;
    //    private IEnumerable<UserAccountDetail> _usersAccount;

    //    public IEnumerable<UserDetail> User {
    //        get { 
    //            return _user;
    //        }

    //        set {
    //            if (value.Count() > 0)
    //            {
    //                _user = value;
    //            }
    //        } 
    //    }
    //    public IEnumerable<UserAccountDetail> AccountDetail {
    //        get
    //        {
    //            return _usersAccount;
    //        }

    //        set
    //        {
    //            if (value.Count() > 0)
    //            {
    //                _usersAccount = value;
    //            }
    //        }
    //    }
    //}
    public class DataService<T> : IService<T> where T : class
    {
        private readonly IDataProvider _dataProvider;
        private readonly IDataService _dataService;
        public DataService(IDataProvider dataProvider, IDataService dataService)
        {
            this._dataProvider = dataProvider;
            this._dataService = dataService;
        }

        public Task<IEnumerable<T>> Get()
        {
            if (typeof(T) == typeof(UserDetail))
            {
                var users = _dataProvider.User.Select(u => new UserDetail
                {
                    Id = u.Id.ToString(),
                    Name = u.Name,
                    Email = u.Email,
                    IsVerified = u.IsVerfied ?? false
                });
                return Task.FromResult(users as IEnumerable<T>);
            }
            else if (typeof(T) == typeof(UserAccountDetail))
            {
                var accounts = _dataProvider.Account.Select(a => new UserAccountDetail
                {
                    Id = a.Id,
                    UserId = a.UserId,
                    Password = a.Password,
                    CreatedAt = a.CreatedAt,
                    LoggedInAt = a.LoggedInAt
                });
                return Task.FromResult(accounts as IEnumerable<T>);
            }
            
            throw new NotSupportedException($"Type {typeof(T).Name} is not supported. Only UserDetail and UserAccountDetail are supported.");
        }

        public Task<bool> Save(T entity)
        {
            throw new NotImplementedException();
        }
    }
}