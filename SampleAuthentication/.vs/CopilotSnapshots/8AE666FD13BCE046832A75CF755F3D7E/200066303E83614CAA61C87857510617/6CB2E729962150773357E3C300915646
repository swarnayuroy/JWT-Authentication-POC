using API_Service.RepositoryLayer.Interface;
using API_Service.Models.DTO;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using System.Net;

namespace API_Service.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class AccountController : ControllerBase
    {
        private readonly IAccountRepository _accountService;
        public AccountController(IAccountRepository accountService)
        {
            this._accountService = accountService;
        }

        [HttpPost]
        [Route("check")]
        public async Task<HttpResponseMessage> Check([FromBody] UserCredential userCredential)
        {
            try
            {
                var response = await _accountService.CheckCredential(userCredential);

                return response.Status
                    ? new HttpResponseMessage(HttpStatusCode.OK)
                    : new HttpResponseMessage(HttpStatusCode.Unauthorized)
                    {
                        Content = new StringContent(response.Message)
                    };
            }
            catch (Exception)
            {
                return new HttpResponseMessage(HttpStatusCode.InternalServerError)
                {
                    Content = new StringContent("An error occurred while processing your request.")
                };
            }
        }

        [HttpPost]
        [Route("register")]
        public async Task<HttpResponseMessage> Register([FromBody] UserDetail userRegistrationDetail)
        {
            try
            {
                var response = await _accountService.RegisterUser(userRegistrationDetail);
                return response.Status
                    ? new HttpResponseMessage(HttpStatusCode.Created) { Content = new StringContent(response.Message) }
                    : new HttpResponseMessage(HttpStatusCode.Conflict) { Content = new StringContent(response.Message) };
            }
            catch (Exception)
            {
                return new HttpResponseMessage(HttpStatusCode.InternalServerError)
                {
                    Content = new StringContent("An error occurred while processing your request.")
                };
            }
        }
    }
}
